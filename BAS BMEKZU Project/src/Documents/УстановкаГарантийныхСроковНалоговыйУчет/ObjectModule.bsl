#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
// ПРОЦЕДУРЫ И ФУНКЦИИ ДЛЯ ОБЕСПЕЧЕНИЯ ПРОВЕДЕНИЯ ДОКУМЕНТА

// Выполняет движения по регистрам 
//
Процедура ДвиженияПоРегистрам(СтруктураШапкиДокумента, Отказ, Заголовок)
	
	ГарантийныеСрокиНУ = Движения.ГарантийныеСрокиНалоговыйУчет;

	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка",      Ссылка);
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	УстановкаГарантийныхСроков.НоменклатурнаяГруппа,
	|	УстановкаГарантийныхСроков.Срок
	|ИЗ
	|	Документ.УстановкаГарантийныхСроковНалоговыйУчет.ГарантийныеСроки КАК УстановкаГарантийныхСроков
	|ГДЕ
	|	УстановкаГарантийныхСроков.Ссылка = &Ссылка
	|";
	РезультатЗапроса = Запрос.Выполнить().Выгрузить();

	Для Каждого Строка Из РезультатЗапроса Цикл

		НоваяСтрока = ГарантийныеСрокиНУ.Добавить();

		НоваяСтрока.Период        			= СтруктураШапкиДокумента.Дата;
		НоваяСтрока.Организация				= СтруктураШапкиДокумента.Организация;
		НоваяСтрока.НоменклатурнаяГруппа	= Строка.НоменклатурнаяГруппа;
		НоваяСтрока.Срок 					= Строка.Срок;

	КонецЦикла;

КонецПроцедуры // ДвиженияПоРегистрам()

// Процедура - обработчик события "ОбработкаПроведения"
//
Процедура ОбработкаПроведения(Отказ, Режим)

	// ПОДГОТОВКА ПРОВЕДЕНИЯ ПО ДАННЫМ ДОКУМЕНТА
	ПроведениеСервер.ПодготовитьНаборыЗаписейКПроведению(ЭтотОбъект);
	
 	// Сформируем структуру реквизитов шапки документа
	СтруктураШапкиДокумента = ОбщегоНазначенияРед12.СформироватьСтруктуруШапкиДокумента(ЭтотОбъект);
	
	Заголовок = ОбщегоНазначенияБПВызовСервера.ПредставлениеДокументаПриПроведении(Ссылка);
	
	Если НЕ Отказ Тогда
	
		ДвиженияПоРегистрам(СтруктураШапкиДокумента, Отказ, Заголовок);
	
	КонецЕсли; 
	
	ПроведениеСервер.ПодготовитьНаборыЗаписейКЗаписиДвижений(ЭтотОбъект);
                                                                              	
КонецПроцедуры // ОбработкаПроведения()

Процедура ОбработкаУдаленияПроведения(Отказ)
	
	ПроведениеСервер.ПодготовитьНаборыЗаписейКОтменеПроведения(ЭтотОбъект);
	Движения.Записать();

КонецПроцедуры // ОбработкаУдаленияПроведения()

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	
	ЗаполнениеДокументов.Заполнить(ЭтотОбъект, ДанныеЗаполнения);
	
КонецПроцедуры // ОбработкаЗаполнения()

#КонецЕсли
