#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПроцедурыИФункцииПечати

Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
		
	// Ведомость отвесов (Автомобильные весы)
	КомандаПечати = КомандыПечати.Добавить();
	КомандаПечати.Идентификатор = "ПФ_MXL_АвтомобильныеВесы";
	КомандаПечати.Представление = НСтр("ru='Ведомость отвесов (Автомобильные весы)';uk='Відомість зважувань (автомобільні ваги)'");
	КомандаПечати.Обработчик    = "УправлениеПечатьюБПКлиент.ВыполнитьКомандуПечати";
	КомандаПечати.СписокФорм    = "ФормаДокумента,ФормаСписка";
	ПодключаемыеКоманды.ДобавитьУсловиеВидимостиКоманды(КомандаПечати, "Весы",
		Перечисления.ИНАГРО_ВидыВесов.АвтомобильныеВесы, ВидСравненияКомпоновкиДанных.Равно);

	// Ведомость отвесов (Бункерные весы)
	КомандаПечати = КомандыПечати.Добавить();
	КомандаПечати.Идентификатор = "ПФ_MXL_БункерныеВесы";
	КомандаПечати.Представление = НСтр("ru='Ведомость отвесов (Бункерные весы)';uk='Відомість зважувань (Бункерні ваги)'");
	КомандаПечати.Обработчик    = "УправлениеПечатьюБПКлиент.ВыполнитьКомандуПечати";
	КомандаПечати.СписокФорм    = "ФормаДокумента,ФормаСписка";
	ПодключаемыеКоманды.ДобавитьУсловиеВидимостиКоманды(КомандаПечати, "Весы",
		Перечисления.ИНАГРО_ВидыВесов.БункерныеВесы, ВидСравненияКомпоновкиДанных.Равно);

	// Реестр документов
	КомандаПечати = КомандыПечати.Добавить();
	КомандаПечати.Идентификатор = "Реестр";
	КомандаПечати.Представление = НСтр("ru='Реестр документов';uk='Реєстр документів'");
	КомандаПечати.ЗаголовокФормы= НСтр("ru='Реестр документов ""Ведомость отвесов""';uk='Реєстр документів ""Відомість зважувань""'");
	КомандаПечати.Обработчик    = "УправлениеПечатьюБПКлиент.ВыполнитьКомандуПечатиРеестраДокументов";
	КомандаПечати.СписокФорм    = "ФормаСписка";
	КомандаПечати.Порядок       = 100;

КонецПроцедуры

Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт
	
	// Устанавливаем признак доступности печати покомплектно.
	ПараметрыВывода.ДоступнаПечатьПоКомплектно = Истина;
	
	// Проверяем, нужно ли для макета АвтомобильныеВеса формировать табличный документ.
	Если УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "ПФ_MXL_АвтомобильныеВесы") Тогда
		// Формируем табличный документ и добавляем его в коллекцию печатных форм.
		УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, "ПФ_MXL_АвтомобильныеВесы", НСтр("ru='Ведомость отвесов (автомобильные весы) ';uk='Відомість зважувань (автомобільні ваги)'"), 
		ПечатьМакета(МассивОбъектов, ОбъектыПечати, ПараметрыВывода), , "Документ.ИНАГРО_ВедомостьОтвесов.ПФ_MXL_АвтомобильныеВесы", ,Истина);
		
	КонецЕсли;
	
	Если УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "ПФ_MXL_БункерныеВесы") Тогда
		// Формируем табличный документ и добавляем его в коллекцию печатных форм.
		УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, "ПФ_MXL_БункерныеВесы", НСтр("ru='Ведомость отвесов (Бункерные веса)';uk='Відомість зважувань (Бункерні ваги)'"), 
		ПечатьБункерныйВесов(МассивОбъектов, ОбъектыПечати, ПараметрыВывода), , "Документ.ИНАГРО_ВедомостьОтвесов.ПФ_MXL_БункерныеВесы", ,Истина);
		
	КонецЕсли;
КонецПроцедуры

Функция ПечатьМакета(МассивОбъектов,ПараметрыПечати, ПараметрыВывода)
	
	УстановитьПривилегированныйРежим(Истина);
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = УправлениеПечатью.МакетПечатнойФормы("Документ.ИНАГРО_ВедомостьОтвесов.ПФ_MXL_АвтомобильныеВесы");
	КодЯзыкаПечать = ПараметрыВывода.КодЯзыкаДляМногоязычныхПечатныхФорм;
	Макет.КодЯзыкаМакета = КодЯзыкаПечать;
	
	//ПервыйДокумент = Истина;
	Для каждого Ссылка Из МассивОбъектов Цикл
		//Если Не ПервыйДокумент Тогда
		//	ТабДокумент.ВывестиГоризонтальныйРазделительСтраниц();
		//КонецЕсли; 
		//ПервыйДокумент = Ложь;
		//Если НЕ Ссылка.Проведен Тогда
		//	ТекстСообщения = НСтр("ru='Перед формированием документ необходимо провести!';uk='Перед формуванням документ необхідно провести!'");
		//	ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
		//КонецЕсли;
		//Макет.КодЯзыкаМакета = "ru";
		
		////Шапка
		ОблШапка = Макет.ПолучитьОбласть("Шапка");
		ОблШапка.Параметры.ОРганизация = Ссылка.Организация; 
		ОблШапка.Параметры.Дата= Формат(Ссылка.Дата,"ДЛФ = Д");
		ОблШапка.Параметры.Культура	= Ссылка.Номенклатура;
		ОблШапка.Параметры.Склад = Ссылка.Склад;
		
		ВидОперации = "";
		Если Ссылка.ВидОперации = "Вывоз" Тогда
		
			ВидОперации = НСтр("ru='Вывоз';uk='Вивезення'");
			ИначеЕсли Ссылка.ВидОперации = "Уничтожение" Тогда 
			ВидОперации = НСтр("ru='Уничтожение';uk='Знищення'");
			ИначеЕсли Ссылка.ВидОперации = "Перевзвешивание" Тогда
			ВидОперации = НСтр("ru='Перевзвешивание';uk='Перезважування'");
		
		КонецЕсли; 
		ОблШапка.Параметры.РодОперации = ВидОперации;
		ОблШапка.Параметры.Весы	= Ссылка.Весы;
		ОблШапка.Параметры.Примечание	= Ссылка.Комментарий;
		ТабДокумент.Вывести(ОблШапка);
		//
		////Строка
		ОблСтрока = Макет.ПолучитьОбласть("Строка");
		ТабЧасть = Ссылка.СписокТТН.Выгрузить();
		Инд = 0;
		Пока ТабЧасть.Количество() > Инд Цикл
			ОблСтрока.Параметры.Ном1 = ТабЧасть[Инд].НомерТТН;
			ОблСтрока.Параметры.Тара1 = ТабЧасть[Инд].ВесТара;
			ОблСтрока.Параметры.Брутто1 = ТабЧасть[Инд].ВесБрутто;
			//ОблСтрока.Параметры.Нетто1 = ТабЧасть[Инд].Вес;
			Инд = Инд + 1;
			Если ТабЧасть.Количество() > Инд Тогда
				ОблСтрока.Параметры.Ном2 = ТабЧасть[Инд].НомерТТН;
				ОблСтрока.Параметры.Тара2 = ТабЧасть[Инд].ВесТара;
				ОблСтрока.Параметры.Брутто2 = ТабЧасть[Инд].ВесБрутто;
				//ОблСтрока.Параметры.Нетто2 = ТабЧасть[Инд].Вес;
				Инд = Инд + 1;
			Иначе
				ОблСтрока.Параметры.Ном2 = "" ;
				ОблСтрока.Параметры.Тара2 = "";
				ОблСтрока.Параметры.Брутто2 = "";
				ОблСтрока.Параметры.Нетто2 = "";
			КонецЕсли;
			ТабДокумент.Вывести(ОблСтрока);
			
		КонецЦикла;	
		
		//валютаДокумента=Справочники.Валюты.	//Дно
		ОблДно = Макет.ПолучитьОбласть("Дно");
		ОблДно.Параметры.ВесБруттоИтого       = Ссылка.СписокТТН.Итог("ВесБрутто");
		ОблДно.Параметры.ВесТараИтого         = Ссылка.СписокТТН.Итог("ВесТара");
		ОблДно.Параметры.ВесНеттоИТого        = Ссылка.СписокТТН.Итог("ВесНетто");
		
		ОблДно.Параметры.ПредседательКомиссии = Ссылка.ПредседательКомиссии;
		ОблДно.Параметры.ПервыйЧлен 	      = Ссылка.ПервыйЧленКомиссии;
		ОблДно.Параметры.ВторойЧлен           = Ссылка.ВторойЧленКомиссии;
		ОблДно.Параметры.ТретийЧлен           = Ссылка.ТретийЧленКомиссии;
		СтрокаВеса = ЧислоПрописью(ОблДно.Параметры.ВесНеттоИТого,"Л = uk_UK; НП=Ложь; FN = Ложь; ДП=Ложь" )+"кілограм";           
		ОблДно.Параметры.ВесПрописью          = СтрЗаменить(СтрокаВеса,"00","");
		
		ТабДокумент.Вывести(ОблДно);
		
	КонецЦикла;
	
	Возврат ТабДокумент;	
	
КонецФункции

Функция ПечатьБункерныйВесов(МассивОбъектов,ПараметрыПечати, ПараметрыВывода)
	
	УстановитьПривилегированныйРежим(Истина);
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = УправлениеПечатью.МакетПечатнойФормы("Документ.ИНАГРО_ВедомостьОтвесов.ПФ_MXL_БункерныеВесы");
	КодЯзыкаПечать = ПараметрыВывода.КодЯзыкаДляМногоязычныхПечатныхФорм;
	Макет.КодЯзыкаМакета = КодЯзыкаПечать;
	
	Для каждого Ссылка Из МассивОбъектов Цикл
		
		////Шапка
		ОблШапка = Макет.ПолучитьОбласть("Шапка");
		ОблШапка.Параметры.ОРганизация = Ссылка.Организация; 
		ОблШапка.Параметры.Дата= Формат(Ссылка.Дата,"ДЛФ = Д");
		ОблШапка.Параметры.Культура	= Ссылка.Номенклатура;
		ОблШапка.Параметры.Склад = Ссылка.Склад;
		Если Ссылка.ВидОперации = "Вывоз" Тогда
		
			ВидОперации = НСтр("ru='Вывоз';uk='Вивезення'");
			ИначеЕсли Ссылка.ВидОперации = "Уничтожение" Тогда 
			ВидОперации = НСтр("ru='Уничтожение';uk='Знищення'");
			ИначеЕсли Ссылка.ВидОперации = "Перевзвешивание" Тогда
			ВидОперации = НСтр("ru='Перевзвешивание';uk='Перезважування'");
		
		КонецЕсли; 
		ОблШапка.Параметры.РодОперации = ВидОперации;
		ОблШапка.Параметры.Весы	= Ссылка.Весы;
		ОблШапка.Параметры.Примечание	= Ссылка.Комментарий;
		ТабДокумент.Вывести(ОблШапка);
		
		////Строка
		ОблСтрока = Макет.ПолучитьОбласть("Строка");
		ТабЧасть = Ссылка.БункерныеВесы.Выгрузить();
		Инд = 0;
		Пока ТабЧасть.Количество() > Инд Цикл
			ОблСтрока.Параметры.Ном1 = Инд+1;
			ОблСтрока.Параметры.НачСмены1 = ТабЧасть[Инд].СчетчикНаНачалоСмены;
			ОблСтрока.Параметры.КонСмены1 = ТабЧасть[Инд].СчетчикНаКонецСмены;
			ОблСтрока.Параметры.кол1 = ТабЧасть[Инд].КоличествоОтвесов;
			ОблСтрока.Параметры.Отвес1 = ТабЧасть[Инд].ПоказанияОтвеса;
			ОблСтрока.Параметры.нетто1 = ТабЧасть[Инд].ВесНетто;
			Инд = Инд + 1;
			Если ТабЧасть.Количество() > Инд Тогда
				ОблСтрока.Параметры.Ном2 = Инд+1;
				ОблСтрока.Параметры.НачСмены2 = ТабЧасть[Инд].СчетчикНаНачалоСмены;
				ОблСтрока.Параметры.КонСмены2 = ТабЧасть[Инд].СчетчикНаКонецСмены;
				ОблСтрока.Параметры.кол2 = ТабЧасть[Инд].КоличествоОтвесов;
				ОблСтрока.Параметры.Отвес2 = ТабЧасть[Инд].ПоказанияОтвеса;
				ОблСтрока.Параметры.нетто2 = ТабЧасть[Инд].ВесНетто;
				Инд = Инд + 1;
			Иначе
				ОблСтрока.Параметры.Ном2 = "";
				ОблСтрока.Параметры.НачСмены2 = "";
				ОблСтрока.Параметры.КонСмены2 = "";
				ОблСтрока.Параметры.кол2 = "";
				ОблСтрока.Параметры.Отвес2 = "";
				ОблСтрока.Параметры.нетто2 = "";
				
			КонецЕсли;
			ТабДокумент.Вывести(ОблСтрока);
			
		КонецЦикла;	
		// валютаДокумента=Справочники.Валюты.	
		
		// Дно
		ОблДно = Макет.ПолучитьОбласть("Дно");		
		ОблДно.Параметры.ПредседательКомиссии = Ссылка.ПредседательКомиссии;
		ОблДно.Параметры.ПервыйЧлен 	      = Ссылка.ПервыйЧленКомиссии;
		ОблДно.Параметры.ВторойЧлен           = Ссылка.ВторойЧленКомиссии;
		ОблДно.Параметры.ТретийЧлен           = Ссылка.ТретийЧленКомиссии;
		СтрокаВеса = ЧислоПрописью(Ссылка.БункерныеВесы.Итог("ВесНетто"),"Л = uk_UK; НП=Ложь; FN = Ложь; ДП=Ложь" )+"кілограм";           
		ОблДно.Параметры.ВесПрописью          = СтрЗаменить(СтрокаВеса,"00","");
		
		ТабДокумент.Вывести(ОблДно);
		
	КонецЦикла;	
	
	Возврат ТабДокумент;
	
КонецФункции

Функция ПолучитьДополнительныеРеквизитыДляРеестра() Экспорт
	
	Результат = Новый Структура;	
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти 

#КонецЕсли