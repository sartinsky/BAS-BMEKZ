#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, ТекстЗаполнения, СтандартнаяОбработка)

	ТипДанныхЗаполнения = ТипЗнч(ДанныеЗаполнения);	
	
	ИНАГРО_ЭлеваторЗаполнениеДокументов.ЗаполнитьШапкуДокумента(ЭтотОбъект);

	ЗаполнениеДокументов.Заполнить(ЭтотОбъект, ДанныеЗаполнения);

КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;			
	КонецЕсли;

КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, РежимПроведения)	
	
	Перем Заголовок;
	
	ПроведениеСервер.ПодготовитьНаборыЗаписейКПроведению(ЭтотОбъект);
	
	// Заголовок для сообщений об ошибках проведения.
	Заголовок = ОбщегоНазначенияБПВызовСервера.ПредставлениеДокументаПриПроведении(Ссылка);
	
	// Движения по документу
	Если НЕ Отказ Тогда
		ДвиженияПоРегистру_ИНАГРО_РезультатыНаблюденияСостоянияЗерна();
	КонецЕсли;
	
	ПроведениеСервер.ПодготовитьНаборыЗаписейКЗаписиДвижений(ЭтотОбъект);
	
КонецПроцедуры

Процедура ОбработкаУдаленияПроведения(Отказ)
	
	ПроведениеСервер.ПодготовитьНаборыЗаписейКОтменеПроведения(ЭтотОбъект);
	Движения.Записать();
	
КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)

	Дата = НачалоДня(ОбщегоНазначения.ТекущаяДатаПользователя());
	Ответственный = Пользователи.ТекущийПользователь();
	
КонецПроцедуры

#КонецОбласти

#Область Проведение

Процедура ДвиженияПоРегистру_ИНАГРО_РезультатыНаблюденияСостоянияЗерна()
	
	Для Каждого СтрРезультаты Из Результаты Цикл
		
		Движение = Движения.ИНАГРО_РезультатыНаблюденияСостоянияЗерна.Добавить();
		Движение.Период                   = Дата;
		Движение.Организация              = ?(ЗначениеЗаполнено(Организация), Организация, Справочники.Организации.ПустаяСсылка());
		Движение.Урожай                   = ?(ЗначениеЗаполнено(Урожай),      Урожай,      Справочники.ИНАГРО_ВидыУрожая.ПустаяСсылка());
		Движение.Склад                    = ?(ЗначениеЗаполнено(Склад),       Склад,       Справочники.Склады.ПустаяСсылка());
		Движение.ВидХранения              = ?(ЗначениеЗаполнено(ВидХранения), ВидХранения, Справочники.ИНАГРО_ВидыХранения.ПустаяСсылка());
		Движение.Номенклатура             = Номенклатура;
		Движение.Силос                    = СтрРезультаты.Силос;
		Движение.Вес                      = СтрРезультаты.Вес;
		Движение.Натура                   = СтрРезультаты.Натура;
		Движение.Влажность                = СтрРезультаты.Влажность;
		Движение.СорнаяПримесь            = СтрРезультаты.СорнаяПримесь;
		Движение.ЗерноваяПримесь          = СтрРезультаты.ЗерноваяПримесь;
		Движение.ТемператураВоздуха       = СтрРезультаты.ТемператураВоздуха;
		Движение.ТемператураВерхнегоСлоя  = СтрРезультаты.ТемператураВерхнегоСлоя;
		Движение.ТемператураСреднегоСлоя  = СтрРезультаты.ТемператураСреднегоСлоя;
		Движение.ТемператураНижнегоСлоя   = СтрРезультаты.ТемператураНижнегоСлоя;
		Движение.Запах                    = СтрРезультаты.Запах;
		Движение.ЗараженностьВерхнегоСлоя = СтрРезультаты.ЗараженностьВерхнегоСлоя;
		Движение.ЗараженностьСреднегоСлоя = СтрРезультаты.ЗараженностьСреднегоСлоя;
		Движение.ЗараженностьНижнегоСлоя  = СтрРезультаты.ЗараженностьНижнегоСлоя;
		
	КонецЦикла;
	
	Движения.ИНАГРО_РезультатыНаблюденияСостоянияЗерна.Записать();

КонецПроцедуры

#КонецОбласти

#КонецЕсли
