
Процедура СохранитьСодержимоеЭлектронногоДокумента(
	ЭлектронныйДокумент,
	НомерВерсии,
	ТелоДокумента,
	ИзображениеДокумента,
	ВложениеДокумента1,
	ИмяФайлаВложениеДокумента1,
	ВложениеДокумента2,
	ИмяФайлаВложениеДокумента2,
	ВложениеДокумента3,
	ИмяФайлаВложениеДокумента3,
	МассивВложенийДокумента4,
	Дата,
	ИмяФайла,
	ВерсияДокументаВПлатформеПТАХ,
	СсылкаНаДокумент,
	ДокументДФС,
	ПолученоОтКонтрагента,
	ПолученоОтКонтрагентаСПомощью,
	ДокументДляДФС
	) Экспорт
	
	
	СохранитьСодержимоеЭлектронногоДокумента_ВыполнитьЗапись(
		ЭлектронныйДокумент,
		НомерВерсии,
		0,
		ТелоДокумента,
		ИзображениеДокумента,
		ВложениеДокумента1,
		ИмяФайлаВложениеДокумента1,
		ВложениеДокумента2,
		ИмяФайлаВложениеДокумента2,
		ВложениеДокумента3,
		ИмяФайлаВложениеДокумента3,
		Дата,
		ИмяФайла,
		ВерсияДокументаВПлатформеПТАХ,
		СсылкаНаДокумент,
		ДокументДФС,
		ПолученоОтКонтрагента,
		ПолученоОтКонтрагентаСПомощью,
		ДокументДляДФС
		);
	
	
	Если ТипЗнч(МассивВложенийДокумента4) = Тип("Массив") или ТипЗнч(МассивВложенийДокумента4) = Тип("ФиксированныйМассив") Тогда
		НомерДополнения = 1;
		ТекНомерЭлемента = 0;
		Пока Истина Цикл
			дВложениеДокумента1 = "";
			дИмяФайлаВложениеДокумента1 = "";
			дВложениеДокумента2 = "";
			дИмяФайлаВложениеДокумента2 = "";
			дВложениеДокумента3 = "";
			дИмяФайлаВложениеДокумента3 = "";
			Сохранять = Ложь;
			
			Если ТекНомерЭлемента < МассивВложенийДокумента4.Количество() Тогда
				ЭлементМассиваВложенийДокумента4 = МассивВложенийДокумента4[ТекНомерЭлемента];
				дВложениеДокумента1 = ЭлементМассиваВложенийДокумента4.ВложениеДокумента;
				дИмяФайлаВложениеДокумента1 = ЭлементМассиваВложенийДокумента4.ИмяФайлаВложениеДокумента;
				ТекНомерЭлемента = ТекНомерЭлемента + 1;
				Сохранять = Истина;
			КонецЕсли;
			
			Если ТекНомерЭлемента < МассивВложенийДокумента4.Количество() Тогда
				ЭлементМассиваВложенийДокумента4 = МассивВложенийДокумента4[ТекНомерЭлемента];
				дВложениеДокумента2 = ЭлементМассиваВложенийДокумента4.ВложениеДокумента;
				дИмяФайлаВложениеДокумента2 = ЭлементМассиваВложенийДокумента4.ИмяФайлаВложениеДокумента;
				ТекНомерЭлемента = ТекНомерЭлемента + 1;
				Сохранять = Истина;
			КонецЕсли;
			
			Если ТекНомерЭлемента < МассивВложенийДокумента4.Количество() Тогда
				ЭлементМассиваВложенийДокумента4 = МассивВложенийДокумента4[ТекНомерЭлемента];
				дВложениеДокумента3 = ЭлементМассиваВложенийДокумента4.ВложениеДокумента;
				дИмяФайлаВложениеДокумента3 = ЭлементМассиваВложенийДокумента4.ИмяФайлаВложениеДокумента;
				ТекНомерЭлемента = ТекНомерЭлемента + 1;
				Сохранять = Истина;
			КонецЕсли;
			
			Если Сохранять Тогда
				СохранитьСодержимоеЭлектронногоДокумента_ВыполнитьЗапись(
					ЭлектронныйДокумент,
					НомерВерсии,
					НомерДополнения,
					"",
					"",
					дВложениеДокумента1,
					дИмяФайлаВложениеДокумента1,
					дВложениеДокумента2,
					дИмяФайлаВложениеДокумента2,
					дВложениеДокумента3,
					дИмяФайлаВложениеДокумента3,
					Дата,
					ИмяФайла,
					ВерсияДокументаВПлатформеПТАХ,
					СсылкаНаДокумент,
					ДокументДФС,
					ПолученоОтКонтрагента,
					ПолученоОтКонтрагентаСПомощью,
					ДокументДляДФС
					);
				
				НомерДополнения = НомерДополнения + 1;
			Иначе
				Прервать;
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
КонецПроцедуры

Процедура СохранитьСодержимоеЭлектронногоДокумента_ВыполнитьЗапись(
	ЭлектронныйДокумент,
	НомерВерсии,
	НомерДополнения,
	ТелоДокумента,
	ИзображениеДокумента,
	ВложениеДокумента1,
	ИмяФайлаВложениеДокумента1,
	ВложениеДокумента2,
	ИмяФайлаВложениеДокумента2,
	ВложениеДокумента3,
	ИмяФайлаВложениеДокумента3,
	Дата,
	ИмяФайла,
	ВерсияДокументаВПлатформеПТАХ,
	СсылкаНаДокумент,
	ДокументДФС,
	ПолученоОтКонтрагента,
	ПолученоОтКонтрагентаСПомощью,
	ДокументДляДФС
	)
	
	ТекВнешнееХранилище = Константы.скEDI_ТекущееВнешнееХранилищеСодержимогоЭлектронныхДокументов.Получить();
	ТекТипХранилища = Неопределено;
	Если ЗначениеЗаполнено(ТекВнешнееХранилище) Тогда
		Если ТекВнешнееХранилище.Настроено Тогда
			ТекТипХранилища = ТекВнешнееХранилище.ТипХранилища;
		Иначе
			ТекВнешнееХранилище = Неопределено;
		КонецЕсли;
	КонецЕсли;
	
	Если ТекТипХранилища = ПредопределенноеЗначение("Перечисление.скEDI_ТипыВнешнихХранилищСодержимогоЭлектронныхДокументов.MSSQLServer") Тогда
		ИдентификаторПоВнешнемуХранилищу = "";
		Если скEDI_ВнешниеХранилищаMSSQLServer.СохранитьСодержимоеЭлектронногоДокумента(ТекВнешнееХранилище, ИдентификаторПоВнешнемуХранилищу, ЭлектронныйДокумент, НомерВерсии,
			ТелоДокумента, ИзображениеДокумента, ВложениеДокумента1, ВложениеДокумента2, ВложениеДокумента3
			) Тогда
			
			СодержимоеЭлектронныхДокументовМенеджерЗаписи = РегистрыСведений.скEDI_СодержимоеЭлектронныхДокументов.СоздатьМенеджерЗаписи();
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ЭлектронныйДокумент = ЭлектронныйДокумент;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.НомерВерсии = НомерВерсии;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.НомерДополнения = НомерДополнения;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТелоДокумента = ТелоДокумента;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИзображениеДокумента = ИзображениеДокумента;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента1 = ВложениеДокумента1;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайлаВложениеДокумента1 = ИмяФайлаВложениеДокумента1;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента2 = ВложениеДокумента2;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайлаВложениеДокумента2 = ИмяФайлаВложениеДокумента2;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента3 = ВложениеДокумента3;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайлаВложениеДокумента3 = ИмяФайлаВложениеДокумента3;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.Дата = Дата;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ПолученоОтКонтрагента = ПолученоОтКонтрагента;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ПолученоОтКонтрагентаСПомощью = ПолученоОтКонтрагентаСПомощью;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ДокументДФС = ДокументДФС;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ДокументдляДФС = ДокументдляДФС;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВнешнееХранилище = ТекВнешнееХранилище;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИдентификаторПоВнешнемуХранилищу = ИдентификаторПоВнешнемуХранилищу;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайла = ИмяФайла;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.DocVer = ВерсияДокументаВПлатформеПТАХ;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.DocHref = СсылкаНаДокумент;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.Записать(Истина);
		Иначе
			СодержимоеЭлектронныхДокументовМенеджерЗаписи = РегистрыСведений.скEDI_СодержимоеЭлектронныхДокументов.СоздатьМенеджерЗаписи();
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ЭлектронныйДокумент = ЭлектронныйДокумент;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.НомерВерсии = НомерВерсии;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.НомерДополнения = НомерДополнения;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТелоДокумента = ТелоДокумента;
			Если ЗначениеЗаполнено(ТелоДокумента) Тогда
				ДвоичныеДанныеПоBase64 =  Base64Значение(ТелоДокумента);
				СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТелоДокументаХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
			КонецЕсли;
			
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИзображениеДокумента = ИзображениеДокумента;
			Если ЗначениеЗаполнено(ИзображениеДокумента) Тогда
				ДвоичныеДанныеПоBase64 =  Base64Значение(ИзображениеДокумента);
				СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИзображениеДокументаХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
			КонецЕсли;
			
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента1 = ВложениеДокумента1;
			Если ЗначениеЗаполнено(ВложениеДокумента1) Тогда
				ДвоичныеДанныеПоBase64 =  Base64Значение(ВложениеДокумента1);
				СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента1ХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
			КонецЕсли;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайлаВложениеДокумента1 = ИмяФайлаВложениеДокумента1;
			
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента2 = ВложениеДокумента2;
			Если ЗначениеЗаполнено(ВложениеДокумента2) Тогда
				ДвоичныеДанныеПоBase64 =  Base64Значение(ВложениеДокумента2);
				СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента2ХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
			КонецЕсли;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайлаВложениеДокумента2 = ИмяФайлаВложениеДокумента2;
			
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента3 = ВложениеДокумента3;
			Если ЗначениеЗаполнено(ВложениеДокумента3) Тогда
				ДвоичныеДанныеПоBase64 =  Base64Значение(ВложениеДокумента3);
				СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента3ХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
			КонецЕсли;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайлаВложениеДокумента3 = ИмяФайлаВложениеДокумента3;
			
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.Дата = Дата;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ПолученоОтКонтрагента = ПолученоОтКонтрагента;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ПолученоОтКонтрагентаСПомощью = ПолученоОтКонтрагентаСПомощью;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ДокументДФС = ДокументДФС;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ДокументдляДФС = ДокументдляДФС;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВнешнееХранилище = ТекВнешнееХранилище;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИдентификаторПоВнешнемуХранилищу = ИдентификаторПоВнешнемуХранилищу;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайла = ИмяФайла;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.DocVer = ВерсияДокументаВПлатформеПТАХ;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.DocHref = СсылкаНаДокумент;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.Записать(Истина);
		КонецЕсли;
	Иначе
		СодержимоеЭлектронныхДокументовМенеджерЗаписи = РегистрыСведений.скEDI_СодержимоеЭлектронныхДокументов.СоздатьМенеджерЗаписи();
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.ЭлектронныйДокумент = ЭлектронныйДокумент;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.НомерВерсии = НомерВерсии;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.НомерДополнения = НомерДополнения;
		//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТелоДокумента = ТелоДокумента;
		Если ЗначениеЗаполнено(ТелоДокумента) Тогда
			ДвоичныеДанныеПоBase64 =  Base64Значение(ТелоДокумента);
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТелоДокументаХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
		КонецЕсли;
		
		//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИзображениеДокумента = ИзображениеДокумента;
		Если ЗначениеЗаполнено(ИзображениеДокумента) Тогда
			ДвоичныеДанныеПоBase64 =  Base64Значение(ИзображениеДокумента);
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИзображениеДокументаХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
		КонецЕсли;
		
		//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента1 = ВложениеДокумента1;
		Если ЗначениеЗаполнено(ВложениеДокумента1) Тогда
			ДвоичныеДанныеПоBase64 =  Base64Значение(ВложениеДокумента1);
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента1ХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
		КонецЕсли;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайлаВложениеДокумента1 = ИмяФайлаВложениеДокумента1;
		
		//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента2 = ВложениеДокумента2;
		Если ЗначениеЗаполнено(ВложениеДокумента2) Тогда
			ДвоичныеДанныеПоBase64 =  Base64Значение(ВложениеДокумента2);
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента2ХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
		КонецЕсли;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайлаВложениеДокумента2 = ИмяФайлаВложениеДокумента2;
		
		//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента3 = ВложениеДокумента3;
		Если ЗначениеЗаполнено(ВложениеДокумента3) Тогда
			ДвоичныеДанныеПоBase64 =  Base64Значение(ВложениеДокумента3);
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента3ХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
		КонецЕсли;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайлаВложениеДокумента3 = ИмяФайлаВложениеДокумента3;
		
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.Дата = Дата;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.ПолученоОтКонтрагента = ПолученоОтКонтрагента;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.ПолученоОтКонтрагентаСПомощью = ПолученоОтКонтрагентаСПомощью;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.ДокументДФС = ДокументДФС;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.ДокументдляДФС = ДокументдляДФС;
		//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВнешнееХранилище = ТекВнешнееХранилище;
		//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИдентификаторПоВнешнемуХранилищу = ИдентификаторПоВнешнемуХранилищу;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИмяФайла = ИмяФайла;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.DocVer = ВерсияДокументаВПлатформеПТАХ;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.DocHref = СсылкаНаДокумент;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.Записать(Истина);
	КонецЕсли;
КонецПроцедуры

Процедура СохранитьСодержимоеДополнительногоЭлектронногоДокументаДФС(
	ЭлектронныйДокумент,
	ТипСодержимого,
	ТелоДокумента,
	ИзображениеДокумента,
	Дата
	) Экспорт
	
	ТекВнешнееХранилище = Константы.скEDI_ТекущееВнешнееХранилищеСодержимогоЭлектронныхДокументов.Получить();
	ТекТипХранилища = Неопределено;
	Если ЗначениеЗаполнено(ТекВнешнееХранилище) Тогда
		Если ТекВнешнееХранилище.Настроено Тогда
			ТекТипХранилища = ТекВнешнееХранилище.ТипХранилища;
		Иначе
			ТекВнешнееХранилище = Неопределено;
		КонецЕсли;
	КонецЕсли;
	
	Если ТекТипХранилища = ПредопределенноеЗначение("Перечисление.скEDI_ТипыВнешнихХранилищСодержимогоЭлектронныхДокументов.MSSQLServer") Тогда
		ИдентификаторПоВнешнемуХранилищу = "";
		Если скEDI_ВнешниеХранилищаMSSQLServer.СохранитьСодержимоеДополнительногоЭлектронногоДокументаДФС(ТекВнешнееХранилище, ИдентификаторПоВнешнемуХранилищу, ЭлектронныйДокумент, ТипСодержимого, ТелоДокумента, ИзображениеДокумента) Тогда
			
			СодержимоеЭлектронныхДокументовМенеджерЗаписи = РегистрыСведений.скEDI_СодержимоеДополнительныхЭлектронныхДокументовДФС.СоздатьМенеджерЗаписи();
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ЭлектронныйДокумент = ЭлектронныйДокумент;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТипСодержимого = ТипСодержимого;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТелоДокумента = ТелоДокумента;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИзображениеДокумента = ИзображениеДокумента;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВложениеДокумента1 = ВложениеДокумента1;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.Дата = Дата;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВнешнееХранилище = ТекВнешнееХранилище;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИдентификаторПоВнешнемуХранилищу = ИдентификаторПоВнешнемуХранилищу;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.Записать(Истина);
		Иначе
			СодержимоеЭлектронныхДокументовМенеджерЗаписи = РегистрыСведений.скEDI_СодержимоеДополнительныхЭлектронныхДокументовДФС.СоздатьМенеджерЗаписи();
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ЭлектронныйДокумент = ЭлектронныйДокумент;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТипСодержимого = ТипСодержимого;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТелоДокумента = ТелоДокумента;
			Если ЗначениеЗаполнено(ТелоДокумента) Тогда
				ДвоичныеДанныеПоBase64 =  Base64Значение(ТелоДокумента);
				СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТелоДокументаХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
			КонецЕсли;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.Дата = Дата;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВнешнееХранилище = ТекВнешнееХранилище;
			//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИдентификаторПоВнешнемуХранилищу = ИдентификаторПоВнешнемуХранилищу;
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.Записать(Истина);
		КонецЕсли;
	Иначе
		СодержимоеЭлектронныхДокументовМенеджерЗаписи = РегистрыСведений.скEDI_СодержимоеДополнительныхЭлектронныхДокументовДФС.СоздатьМенеджерЗаписи();
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.ЭлектронныйДокумент = ЭлектронныйДокумент;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТипСодержимого = ТипСодержимого;
		//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТелоДокумента = ТелоДокумента;
		Если ЗначениеЗаполнено(ТелоДокумента) Тогда
			ДвоичныеДанныеПоBase64 =  Base64Значение(ТелоДокумента);
			СодержимоеЭлектронныхДокументовМенеджерЗаписи.ТелоДокументаХЗ = Новый ХранилищеЗначения(ДвоичныеДанныеПоBase64, Новый СжатиеДанных(9));
		КонецЕсли;
		//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИзображениеДокумента = ИзображениеДокумента;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.Дата = Дата;
		//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ВнешнееХранилище = ТекВнешнееХранилище;
		//СодержимоеЭлектронныхДокументовМенеджерЗаписи.ИдентификаторПоВнешнемуХранилищу = ИдентификаторПоВнешнемуХранилищу;
		СодержимоеЭлектронныхДокументовМенеджерЗаписи.Записать(Истина);
	КонецЕсли;
КонецПроцедуры

Функция ПолучитьСодержимоеЭлектронногоДокумента(
	ВнешнееХранилище,
	ЭлектронныйДокумент,
	ИдентификаторПоВнешнемуХранилищу,
	НомерВерсии,
	ТелоДокумента,
	ИзображениеДокумента,
	ВложениеДокумента1,
	ВложениеДокумента2,
	ВложениеДокумента3,
	Ошибка
	) Экспорт
	
	ТекТипХранилища = Неопределено;
	Если ЗначениеЗаполнено(ВнешнееХранилище) Тогда
		Если ВнешнееХранилище.Настроено Тогда
			ТекТипХранилища = ВнешнееХранилище.ТипХранилища;
		Иначе
			Ошибка = НСтр("ru = 'Внешнее хранилище не настроено!'; uk = 'Зовнішнє сховище не налаштовано!'");
			Ошибка = НСтр("ru = 'Не удалось получить содержимое Электронного документа.'; uk = 'Не вдалось отримати вміст Електронного документу.'") + Символы.ПС + Ошибка;
			Возврат Ложь;
		КонецЕсли;
	Иначе
		Ошибка = НСтр("ru = 'Внешнее хранилища не определено!'; uk = 'Зовнішнє сховища не визначено!'");
		Ошибка = НСтр("ru = 'Не удалось получить содержимое Электронного документа.'; uk = 'Не вдалось отримати вміст Електронного документу.'") + Символы.ПС + Ошибка;
		Возврат Ложь;
	КонецЕсли;
	
	Если ТекТипХранилища = ПредопределенноеЗначение("Перечисление.скEDI_ТипыВнешнихХранилищСодержимогоЭлектронныхДокументов.MSSQLServer") Тогда
		Если скEDI_ВнешниеХранилищаMSSQLServer.ПолучитьСодержимоеЭлектронногоДокумента(ВнешнееХранилище, ЭлектронныйДокумент, ИдентификаторПоВнешнемуХранилищу, НомерВерсии,
			ТелоДокумента, ИзображениеДокумента, ВложениеДокумента1, ВложениеДокумента2, ВложениеДокумента3,
			Ошибка) Тогда
			//Ошибка = "";НСтр("ru = 'Не удалось получить содержимое Электронного документа.'; uk = 'Не вдалось отримати вміст Електронного документу.'") + Символы.ПС + Ошибка;
			Возврат Истина;
		Иначе
			Возврат Ложь;
		КонецЕсли;
	Иначе
		Ошибка = НСтр("ru = 'Тип внешнего хранилища не определен!'; uk = 'Тип зовнішнього сховища не визначено!'");
		Ошибка = НСтр("ru = 'Не удалось получить содержимое Электронного документа.'; uk = 'Не вдалось отримати вміст Електронного документу.'") + Символы.ПС + Ошибка;
		Возврат Ложь;
	КонецЕсли;
КонецФункции

Функция ПолучитьСодержимоеДополнительногоЭлектронногоДокументаДФС(
	ВнешнееХранилище,
	ЭлектронныйДокумент,
	ИдентификаторПоВнешнемуХранилищу,
	ТипСодержимого,
	ТелоДокумента,
	ИзображениеДокумента,
	Ошибка
	) Экспорт
	
	ТекТипХранилища = Неопределено;
	Если ЗначениеЗаполнено(ВнешнееХранилище) Тогда
		Если ВнешнееХранилище.Настроено Тогда
			ТекТипХранилища = ВнешнееХранилище.ТипХранилища;
		Иначе
			Ошибка = НСтр("ru = 'Внешнее хранилище не настроено!'; uk = 'Зовнішнє сховище не налаштовано!'");
			Ошибка = НСтр("ru = 'Не удалось получить содержимое Электронного документа.'; uk = 'Не вдалось отримати вміст Електронного документу.'") + Символы.ПС + Ошибка;
			Возврат Ложь;
		КонецЕсли;
	Иначе
		Ошибка = НСтр("ru = 'Внешнее хранилища не определено!'; uk = 'Зовнішнє сховища не визначено!'");
		Ошибка = НСтр("ru = 'Не удалось получить содержимое Электронного документа.'; uk = 'Не вдалось отримати вміст Електронного документу.'") + Символы.ПС + Ошибка;
		Возврат Ложь;
	КонецЕсли;
	
	Если ТекТипХранилища = ПредопределенноеЗначение("Перечисление.скEDI_ТипыВнешнихХранилищСодержимогоЭлектронныхДокументов.MSSQLServer") Тогда
		Если скEDI_ВнешниеХранилищаMSSQLServer.ПолучитьСодержимоеДополнительногоЭлектронногоДокументаДФС(ВнешнееХранилище, ЭлектронныйДокумент, ИдентификаторПоВнешнемуХранилищу, ТелоДокумента, ИзображениеДокумента, Ошибка) Тогда
			Ошибка = НСтр("ru = 'Не удалось получить содержимое Электронного документа.'; uk = 'Не вдалось отримати вміст Електронного документу.'") + Символы.ПС + Ошибка;
			Возврат Истина;
		Иначе
			Возврат Ложь;
		КонецЕсли;
	Иначе
		Ошибка = НСтр("ru = 'Тип внешнего хранилища не определен!'; uk = 'Тип зовнішнього сховища не визначено!'");
		Ошибка = НСтр("ru = 'Не удалось получить содержимое Электронного документа.'; uk = 'Не вдалось отримати вміст Електронного документу.'") + Символы.ПС + Ошибка;
		Возврат Ложь;
	КонецЕсли;
КонецФункции

