#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

Функция ПолучитьЕдиницуИзмеренияПоУмолчанию() Экспорт
	
	ЕдиницаПоУмолчанию = Справочники.КлассификаторЕдиницИзмерения.НайтиПоКоду("2009");	
	 
	Если ЕдиницаПоУмолчанию = Справочники.КлассификаторЕдиницИзмерения.ПустаяСсылка() Тогда
		ЕдиницаПоУмолчанию = Справочники.КлассификаторЕдиницИзмерения.НайтиПоНаименованию("шт", Истина);
	КонецЕсли;
	
	Возврат ЕдиницаПоУмолчанию;
	
КонецФункции

#КонецЕсли

Процедура ОбработкаПолученияДанныхВыбора(ДанныеВыбора, Параметры, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Номенклатура") Тогда
		
		СтандартнаяОбработка = Ложь;
		
		Номенклатура = Параметры.Номенклатура;
		СтрокаПоиска = Параметры.СтрокаПоиска;
		
		Запрос = Новый Запрос(
		"ВЫБРАТЬ
		|	ЕдиницыИзмерения.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
		|	ЕдиницыИзмерения.ЕдиницаИзмерения.Представление КАК Представление
		|ИЗ
		|	Справочник.Номенклатура.ЕдиницыИзмерения КАК ЕдиницыИзмерения
		|ГДЕ
		|	ЕдиницыИзмерения.Ссылка = &Номенклатура
		|	" + ?(СтрокаПоиска = Неопределено, "", "И ЕдиницыИзмерения.ЕдиницаИзмерения.Наименование ПОДОБНО &СтрокаПоиска") + "
		|УПОРЯДОЧИТЬ ПО
		|	Представление");
			
		Запрос.УстановитьПараметр("Номенклатура",   Номенклатура);
		
		Если СтрокаПоиска <> Неопределено Тогда
			Запрос.УстановитьПараметр("СтрокаПоиска", СтрокаПоиска + "%");
		КонецЕсли;
		
		РезультатЗапроса = Запрос.Выполнить();
		ДанныеВыбора = Новый СписокЗначений;

		Если Не РезультатЗапроса.Пустой() Тогда
			Выборка = РезультатЗапроса.Выбрать();
			Пока Выборка.Следующий() Цикл
				ДанныеВыбора.Добавить(Выборка.ЕдиницаИзмерения,Выборка.Представление);
			КонецЦикла;
		КонецЕсли;
	// ИНАГРО ++	
	ИначеЕсли Параметры.Свойство("БиологическиеАктивы") Тогда
		
		СтандартнаяОбработка = Ложь;
		
		БиологическиеАктивы = Параметры.БиологическиеАктивы;
		СтрокаПоиска = Параметры.СтрокаПоиска;
		
		Запрос = Новый Запрос(
		"ВЫБРАТЬ
		|	ЕдиницыИзмерения.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
		|	ЕдиницыИзмерения.ЕдиницаИзмерения.Представление КАК Представление
		|ИЗ
		|	Справочник.БиологическиеАктивы.ЕдиницыИзмерения КАК ЕдиницыИзмерения
		|ГДЕ
		|	ЕдиницыИзмерения.Ссылка = &БиологическиеАктивы
		|	" + ?(СтрокаПоиска = Неопределено, "", "И ЕдиницыИзмерения.ЕдиницаИзмерения.Наименование ПОДОБНО &СтрокаПоиска") + "
		|УПОРЯДОЧИТЬ ПО
		|	Представление");
			
		Запрос.УстановитьПараметр("БиологическиеАктивы",   БиологическиеАктивы);
		
		Если СтрокаПоиска <> Неопределено Тогда
			Запрос.УстановитьПараметр("СтрокаПоиска", СтрокаПоиска + "%");
		КонецЕсли;
		
		РезультатЗапроса = Запрос.Выполнить();
		ДанныеВыбора = Новый СписокЗначений;

		Если Не РезультатЗапроса.Пустой() Тогда
			Выборка = РезультатЗапроса.Выбрать();
			Пока Выборка.Следующий() Цикл
				ДанныеВыбора.Добавить(Выборка.ЕдиницаИзмерения,Выборка.Представление);
			КонецЦикла;
		КонецЕсли;
	//ИНАГРО --
		
	КонецЕсли;
	
КонецПроцедуры
